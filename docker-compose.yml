# ğŸŒŸ æ–‡è±ªã‚†ã‹ã‚Šåœ°å›³ã‚·ã‚¹ãƒ†ãƒ  v2.0 - å¼·ãã¦ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ ç‰ˆ
# Docker Compose è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

services:
  # ãƒ¡ã‚¤ãƒ³é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠ
  bungo-dev:
    build: .
    container_name: bungo-map-v2-dev
    volumes:
      - .:/app
      - bungo_cache:/app/cache
      # Gitè¨­å®šã®å…±æœ‰
      - ~/.gitconfig:/home/developer/.gitconfig:ro
    ports:
      - "8080:8080"  # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆFlask/FastAPIï¼‰
      - "3000:3000"  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
    environment:
      - BUNGO_ENV=development
      - BUNGO_DEBUG=true
      - BUNGO_LOG_LEVEL=INFO
      - PYTHONPATH=/app
      - DATABASE_URL=postgresql://bungo:bungo123@postgres:5432/bungo_map_db
      - REDIS_URL=redis://redis:6379/0
    working_dir: /app
    tty: true
    stdin_open: true
    command: /bin/bash
    depends_on:
      - postgres
      - redis
    networks:
      - bungo-network

  # PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  postgres:
    image: postgres:15-alpine
    container_name: bungo-postgres-v2
    environment:
      POSTGRES_DB: bungo_map_db
      POSTGRES_USER: bungo
      POSTGRES_PASSWORD: bungo123
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./sql:/docker-entrypoint-initdb.d
    ports:
      - "5433:5432"  # ãƒ­ãƒ¼ã‚«ãƒ«PostgreSQLã¨ã®ç«¶åˆé¿ã‘
    networks:
      - bungo-network

  # Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  redis:
    image: redis:7-alpine
    container_name: bungo-redis-v2
    volumes:
      - redis_data:/data
    ports:
      - "6380:6379"  # ãƒ­ãƒ¼ã‚«ãƒ«Redisã¨ã®ç«¶åˆé¿ã‘
    networks:
      - bungo-network

# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒœãƒªãƒ¥ãƒ¼ãƒ 
volumes:
  postgres_data:
  redis_data:
  bungo_cache:

# ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
networks:
  bungo-network:
    driver: bridge